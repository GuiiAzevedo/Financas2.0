    <script>
        console.log("Scripts carregados.");

        // --- CONFIGURA√á√ÉO DO FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyBHoW1rE9xVAiqOk1ro1SgiI4Rlq4vUx38",
            authDomain: "financas2-c616f.firebaseapp.com",
            projectId: "financas2-c616f",
            storageBucket: "financas2-c616f.firebasestorage.app",
            messagingSenderId: "1029379063635",
            appId: "1:1029379063635:web:b8ec7c6877e9b512686ba6"
        };

        try {
            firebase.initializeApp(firebaseConfig);
            console.log("Firebase inicializado.");
        } catch (e) { 
            console.error("Erro ao iniciar Firebase.", e);
            alert("Erro cr√≠tico ao iniciar o Firebase. Verifique o console.");
        }

        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- ESTADO GLOBAL ---
        let state = {
            transactions: [],
            cards: [],
            logs: [],
            user: null,
            currentGroupId: null
        };

        // --- TEMA ---
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            updateThemeBtn(savedTheme);
        }

        function toggleTheme() {
            const current = document.body.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
            updateThemeBtn(next);
        }

        function updateThemeBtn(theme) {
            const btn = document.getElementById('theme-btn');
            btn.textContent = theme === 'dark' ? '‚òÄÔ∏è Modo Claro' : 'üåô Modo Escuro';
        }

        // --- AUTH ---
        let authMode = 'login';

        function switchAuthTab(mode) {
            authMode = mode;
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(`tab-${mode}`).classList.add('active');
            document.querySelector('#auth-form button').textContent = mode === 'login' ? 'Entrar' : 'Criar Conta';
            document.getElementById('auth-error').textContent = '';
        }

        function handleAuth(e) {
            e.preventDefault();
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-pass').value;
            const errorDiv = document.getElementById('auth-error');
            const btn = document.querySelector('#auth-form button');

            // Feedback visual
            btn.textContent = "Processando...";
            btn.disabled = true;
            errorDiv.textContent = "";

            console.log("Tentando autenticar:", email);

            // MECANISMO DE SEGURAN√áA: Timeout de 10 segundos
            const timeoutId = setTimeout(() => {
                console.error("Timeout de conex√£o (10s).");
                alert("O login est√° demorando muito. \n\nPoss√≠veis causas:\n1. Voc√™ est√° abrindo o arquivo direto (clique duplo) em vez de usar o link do GitHub.\n2. Seu adblocker est√° bloqueando o Firebase.\n3. O provedor 'Email/Senha' est√° desativado no console do Firebase.");
                
                // Reseta bot√£o
                btn.textContent = authMode === 'login' ? 'Acessar' : 'Criar Conta';
                btn.disabled = false;
            }, 10000);

            let authPromise;
            if (authMode === 'register') {
                authPromise = auth.createUserWithEmailAndPassword(email, pass);
            } else {
                authPromise = auth.signInWithEmailAndPassword(email, pass);
            }

            authPromise
                .then(() => {
                    console.log("Sucesso na autentica√ß√£o.");
                    clearTimeout(timeoutId); // Cancela o timeout
                    // O listener onAuthStateChanged cuidar√° do resto
                })
                .catch(err => {
                    console.error("Erro na autentica√ß√£o:", err);
                    clearTimeout(timeoutId); // Cancela o timeout
                    
                    const msg = err.message || "Erro desconhecido.";
                    errorDiv.textContent = msg;
                    alert("Erro: " + msg); 
                    
                    btn.textContent = authMode === 'login' ? 'Acessar' : 'Criar Conta';
                    btn.disabled = false;
                });
        }

        function logout() {
            auth.signOut();
        }

        auth.onAuthStateChanged(user => {
            console.log("Auth state changed:", user ? user.email : "Deslogado");
            if (user) {
                state.user = user;
                document.getElementById('display-email').textContent = user.email;
                // Reseta bot√£o caso tenha voltado pra tela de login (erro no checkUserGroup)
                const btn = document.querySelector('#auth-form button');
                if(btn) { btn.textContent = "Acessar"; btn.disabled = false; }
                checkUserGroup(user.uid);
            } else {
                state.user = null;
                state.currentGroupId = null;
                document.getElementById('auth-overlay').classList.add('open');
                document.getElementById('group-overlay').classList.remove('open');
                document.getElementById('app-sidebar').classList.add('hidden');
                document.getElementById('app-main').classList.add('hidden');
                document.getElementById('loading-overlay').classList.add('hidden');
            }
        });

        // --- GRUPO L√ìGICA ---
        async function checkUserGroup(uid) {
            console.log("Verificando grupo para UID:", uid);
            document.getElementById('loading-overlay').classList.remove('hidden');
            try {
                const userDoc = await db.collection('users').doc(uid).get();
                if (userDoc.exists && userDoc.data().groupId) {
                    state.currentGroupId = userDoc.data().groupId;
                    console.log("Grupo encontrado:", state.currentGroupId);
                    loadApp();
                } else {
                    console.log("Usu√°rio sem grupo. Mostrando tela de grupo.");
                    document.getElementById('auth-overlay').classList.remove('open');
                    document.getElementById('group-overlay').classList.add('open');
                    document.getElementById('loading-overlay').classList.add('hidden');
                }
            } catch (e) {
                console.error("Erro cr√≠tico em checkUserGroup:", e);
                alert("Erro ao carregar dados do usu√°rio: " + e.message);
                document.getElementById('loading-overlay').classList.add('hidden'); // Libera a tela
            }
        }

        async function createGroup() {
            const name = document.getElementById('group-name-input').value;
            if(!name) return alert("Digite um nome");

            try {
                const groupRef = await db.collection('groups').add({ name: name, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
                await db.collection('users').doc(state.user.uid).set({ groupId: groupRef.id }, { merge: true });
                
                state.currentGroupId = groupRef.id;
                showToast(`Grupo "${name}" criado!`, 'success');
                document.getElementById('group-overlay').classList.remove('open');
                loadApp();
            } catch (e) { 
                console.error(e);
                alert("Erro ao criar grupo: " + e.message);
            }
        }

        async function joinGroup() {
            const code = document.getElementById('group-code-input').value.trim();
            if(!code) return alert("Digite o c√≥digo");

            try {
                const groupDoc = await db.collection('groups').doc(code).get();
                if (groupDoc.exists) {
                    await db.collection('users').doc(state.user.uid).set({ groupId: code }, { merge: true });
                    state.currentGroupId = code;
                    showToast(`Entrou no grupo: ${groupDoc.data().name}`, 'success');
                    document.getElementById('group-overlay').classList.remove('open');
                    loadApp();
                } else {
                    alert("C√≥digo de grupo inv√°lido.");
                }
            } catch (e) {
                console.error(e);
                alert("Erro ao entrar no grupo: " + e.message);
            }
        }

        // --- FUN√á√ÉO: SAIR DO GRUPO ---
        async function leaveGroup() {
            if (!confirm("Tem certeza que deseja sair deste grupo?")) return;

            try {
                await db.collection('users').doc(state.user.uid).update({
                    groupId: firebase.firestore.FieldValue.delete()
                });

                state.currentGroupId = null;

                document.getElementById('app-sidebar').classList.add('hidden');
                document.getElementById('app-main').classList.add('hidden');
                document.getElementById('group-overlay').classList.add('open');
                
                showToast('Voc√™ saiu do grupo.', 'info');
            } catch (e) {
                console.error(e);
                alert("Erro ao sair: " + e.message);
            }
        }

        function loadApp() {
            document.getElementById('app-sidebar').classList.remove('hidden');
            document.getElementById('app-main').classList.remove('hidden');
            document.getElementById('loading-overlay').classList.add('hidden');
            
            db.collection('groups').doc(state.currentGroupId).get().then(doc => {
                if(doc.exists) {
                    document.getElementById('display-group-name').textContent = doc.data().name;
                    document.getElementById('display-group-id').textContent = `ID: ${state.currentGroupId}`;
                }
            }).catch(e => console.error(e));

            loadGroupData();
        }

        function loadGroupData() {
            if(!state.currentGroupId) return;

            // Listener de Transactions
            db.collection('groups').doc(state.currentGroupId).collection('transactions')
                .orderBy('date', 'desc').onSnapshot(snapshot => {
                state.transactions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateUI();
            }, err => {
                console.error("Erro ouvindo transa√ß√µes:", err);
                alert("Erro de permiss√£o ao ler transa√ß√µes. Verifique as regras do Firestore.");
            });

            // Listener de Cards
            db.collection('groups').doc(state.currentGroupId).collection('cards')
                .onSnapshot(snapshot => {
                state.cards = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateUI();
            }, err => console.error(err));

            // Listener de Logs
            db.collection('groups').doc(state.currentGroupId).collection('logs')
                .orderBy('timestamp', 'desc').limit(50).onSnapshot(snapshot => {
                state.logs = snapshot.docs.map(doc => doc.data());
                renderLogs();
            }, err => console.error(err));
        }

        // --- CRUD ---
        async function saveTransactionToFirebase(tData, id = null) {
            const col = db.collection('groups').doc(state.currentGroupId).collection('transactions');
            try {
                if (id) {
                    await col.doc(id).update(tData);
                    addLog('edit', `Editou: ${tData.desc}`);
                    showToast('Atualizado!', 'success');
                } else {
                    await col.add({ ...tData, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
                    addLog('add', `Adicionou: ${tData.desc}`);
                    showToast('Salvo!', 'success');
                }
            } catch (e) { showToast('Erro ao salvar: ' + e.message, 'error'); }
        }

        async function deleteTransactionFromFirebase(id) {
            try {
                const t = state.transactions.find(x => x.id === id);
                await db.collection('groups').doc(state.currentGroupId).collection('transactions').doc(id).delete();
                addLog('delete', `Excluiu: ${t ? t.desc : ''}`);
                showToast('Removido.', 'info');
            } catch (e) { showToast('Erro ao excluir', 'error'); }
        }

        async function saveCardToFirebase(cData, id = null) {
            const col = db.collection('groups').doc(state.currentGroupId).collection('cards');
            try {
                if (id) {
                    await col.doc(id).update(cData);
                    addLog('edit', `Editou cart√£o: ${cData.name}`);
                    showToast('Atualizado!', 'success');
                } else {
                    await col.add(cData);
                    addLog('add', `Criou cart√£o: ${cData.name}`);
                    showToast('Criado!', 'success');
                }
            } catch (e) { showToast('Erro ao salvar cart√£o', 'error'); }
        }

        async function deleteCardFromFirebase(id) {
            if(state.transactions.some(t => t.cardId == id)) return showToast('Cart√£o em uso.', 'error');
            try {
                const c = state.cards.find(x => x.id === id);
                await db.collection('groups').doc(state.currentGroupId).collection('cards').doc(id).delete();
                addLog('delete', `Excluiu cart√£o: ${c ? c.name : ''}`);
                showToast('Removido.', 'info');
            } catch (e) { showToast('Erro ao excluir', 'error'); }
        }

        function addLog(type, message) {
            db.collection('groups').doc(state.currentGroupId).collection('logs').add({
                type, message, user: state.user.email,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
        }

        function clearLogs() {
             if(!confirm("Limpar logs?")) return;
             db.collection('groups').doc(state.currentGroupId).collection('logs').get().then(snapshot => {
                 snapshot.forEach(doc => doc.ref.delete());
             });
        }

        // --- UI ---
        function updateUI() {
            renderSummary();
            renderTransactionsList();
            renderCards();
            updateCardSelect();
            renderMonthlyChart();
        }

        function renderSummary() {
            const income = state.transactions.filter(t => t.type === 'income').reduce((acc, t) => acc + parseFloat(t.amount), 0);
            const expense = state.transactions.filter(t => t.type === 'expense').reduce((acc, t) => acc + parseFloat(t.amount), 0);
            document.getElementById('total-income').textContent = formatCurrency(income);
            document.getElementById('total-expense').textContent = formatCurrency(expense);
            document.getElementById('total-balance').textContent = formatCurrency(income - expense);
        }

        function renderTransactionsList() {
            const list = document.getElementById('all-transactions-list');
            const recent = document.getElementById('recent-transactions-list');
            const search = document.getElementById('search-input').value.toLowerCase();
            const filtered = state.transactions.filter(t => t.desc.toLowerCase().includes(search) || t.category.toLowerCase().includes(search));

            const generateHTML = (t, showActions = false) => {
                const isExpense = t.type === 'expense';
                const colorClass = isExpense ? 'text-danger' : 'text-success';
                const sign = isExpense ? '-' : '+';
                let cardTag = '';
                if (t.cardId) {
                    const card = state.cards.find(c => c.id == t.cardId);
                    if (card) cardTag = `<span class="tag" style="border:1px solid ${card.color}; color:${card.color}">${card.name}</span>`;
                }
                const actionBtns = showActions ? `
                    <div class="action-buttons">
                        <button class="btn btn-sm btn-outline" onclick="openTransactionModal('${t.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteTransactionFromFirebase('${t.id}')">üóë</button>
                    </div>` : '';

                return `
                <div class="list-item">
                    <div class="item-info">
                        <h4>${t.desc} ${cardTag}</h4>
                        <p>${formatDate(t.date)} ‚Ä¢ ${t.category}</p>
                    </div>
                    <div style="display:flex; align-items:center;">
                        <div class="item-amount ${colorClass}" style="margin-right: 15px;">${sign} ${formatCurrency(t.amount, false)}</div>
                        ${actionBtns}
                    </div>
                </div>`;
            };

            list.innerHTML = filtered.length ? filtered.map(t => generateHTML(t, true)).join('') : '<div class="empty-state">Nada encontrado.</div>';
            recent.innerHTML = state.transactions.slice(0, 5).map(t => generateHTML(t, false)).join('');
        }

        function renderCards() {
            const container = document.getElementById('cards-container');
            if (state.cards.length === 0) { container.innerHTML = '<div class="empty-state">Sem cart√µes.</div>'; return; }

            container.innerHTML = state.cards.map(card => {
                const spent = state.transactions.filter(t => t.cardId == card.id && t.type === 'expense').reduce((acc, t) => acc + parseFloat(t.amount), 0);
                const percent = Math.min((spent / card.limit) * 100, 100);
                return `
                <div class="credit-card-ui" style="background: linear-gradient(135deg, ${card.color} 0%, #2d3748 100%);">
                    <div class="flex-between" style="margin:0; color:white;">
                        <div class="card-name">${card.name}</div>
                        <div>
                            <button onclick="openCardModal('${card.id}')" style="background:none; border:none; color:white; cursor:pointer; margin-right:10px;">‚úèÔ∏è</button>
                            <button onclick="deleteCardFromFirebase('${card.id}')" style="background:none; border:none; color:white; cursor:pointer;">üóë</button>
                        </div>
                    </div>
                    <div style="font-size: 2rem; letter-spacing: 2px; margin: 1rem 0;">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
                    <div class="card-limit-info">
                        <div class="flex-between" style="margin:0; font-size: 0.8rem; color: rgba(255,255,255,0.8);">
                            <span>Gasto: ${formatCurrency(spent, false)}</span>
                            <span>Limite: ${formatCurrency(card.limit, false)}</span>
                        </div>
                        <div class="progress-bar-bg">
                            <div class="progress-bar-fill" style="width: ${percent}%"></div>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        function updateCardSelect() {
            const select = document.getElementById('t-card');
            select.innerHTML = '<option value="">Dinheiro / D√©bito</option>';
            state.cards.forEach(c => { select.innerHTML += `<option value="${c.id}">${c.name}</option>`; });
        }

        function renderLogs() {
            const container = document.getElementById('logs-list');
            if (state.logs.length === 0) { container.innerHTML = '<div class="empty-state">Sem logs.</div>'; return; }
            
            container.innerHTML = state.logs.map(log => {
                let dateStr = log.timestamp && log.timestamp.toDate ? log.timestamp.toDate().toLocaleString('pt-BR') : '';
                const color = log.type === 'add' ? 'var(--success)' : (log.type === 'delete' ? 'var(--danger)' : 'var(--warning)');
                return `
                <div style="position: relative; padding-left: 20px; margin-bottom: 10px;">
                    <div style="position: absolute; left: -26px; top: 5px; width: 10px; height: 10px; border-radius: 50%; background: ${color}; border: 2px solid var(--bg-card);"></div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary);">${dateStr} ‚Ä¢ <strong>${log.user}</strong></div>
                    <div style="font-size: 0.95rem;">${log.message}</div>
                </div>`;
            }).join('');
        }

        // --- GR√ÅFICO MENSAL ---
        function renderMonthlyChart() {
            const container = document.getElementById('monthly-chart-container');
            container.innerHTML = '';
            
            const months = [];
            for (let i = 5; i >= 0; i--) {
                const d = new Date(); d.setMonth(d.getMonth() - i);
                const k = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2, '0')}`;
                const label = d.toLocaleString('pt-BR', { month: 'short' });
                months.push({ key: k, label });
            }

            const data = months.map(m => {
                const inc = state.transactions.filter(t => t.type === 'income' && t.date.startsWith(m.key)).reduce((a,b) => a + parseFloat(b.amount), 0);
                const exp = state.transactions.filter(t => t.type === 'expense' && t.date.startsWith(m.key)).reduce((a,b) => a + parseFloat(b.amount), 0);
                return { ...m, inc, exp };
            });

            const maxVal = Math.max(...data.map(d => Math.max(d.inc, d.exp))) || 100;
            const w = 300, h = 150, barW = 15, gap = 20, chartH = 120;
            
            let svg = `<svg width="100%" height="100%" viewBox="0 0 ${w} ${h}">`;
            svg += `<rect x="10" y="0" width="10" height="10" fill="#48bb78"/> <text x="25" y="10" font-size="10" fill="var(--text-secondary)">Entradas</text>`;
            svg += `<rect x="80" y="0" width="10" height="10" fill="#f56565"/> <text x="95" y="10" font-size="10" fill="var(--text-secondary)">Sa√≠das</text>`;

            data.forEach((d, i) => {
                const x = 30 + i * (barW * 2 + gap);
                const hInc = (d.inc / maxVal) * chartH, hExp = (d.exp / maxVal) * chartH;
                const yInc = h - 20 - hInc, yExp = h - 20 - hExp;
                
                svg += `<rect x="${x}" y="${yInc}" width="${barW}" height="${hInc}" fill="#48bb78" rx="2"><title>Entradas: ${formatCurrency(d.inc)}</title></rect>`;
                svg += `<rect x="${x + barW}" y="${yExp}" width="${barW}" height="${hExp}" fill="#f56565" rx="2"><title>Sa√≠das: ${formatCurrency(d.exp)}</title></rect>`;
                svg += `<text x="${x + barW}" y="${h - 5}" font-size="10" text-anchor="middle" fill="var(--text-secondary)">${d.label}</text>`;
            });
            svg += `</svg>`;
            container.innerHTML = svg;
        }

        // --- EXPORTAR PDF ---
        function exportPDF() {
            const element = document.getElementById('all-transactions-list');
            const opt = {
                margin:       1,
                filename:     `Relatorio_Financas_${new Date().toISOString().split('T')[0]}.pdf`,
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2 },
                jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
            };
            const clone = element.cloneNode(true);
            const wrapper = document.createElement('div');
            wrapper.style.padding = "20px";
            wrapper.style.background = "white";
            wrapper.innerHTML = `<h2>Relat√≥rio de Transa√ß√µes</h2><p>Gerado em: ${new Date().toLocaleString()}</p>` + clone.innerHTML;
            
            html2pdf().set(opt).from(wrapper).save();
        }

        // --- INTERACTION HELPERS ---
        function showSection(id, navEl) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            navEl.classList.add('active');
            if(window.innerWidth <= 768) document.getElementById('app-sidebar').classList.remove('open');
        }

        function toggleSidebar() { document.getElementById('app-sidebar').classList.toggle('open'); }

        function selectType(type, el) {
            document.querySelectorAll('.radio-option').forEach(e => e.classList.remove('selected'));
            el.classList.add('selected');
            document.getElementById('card-select-group').style.display = type === 'expense' ? 'block' : 'none';
            if(type === 'income') document.getElementById('t-card').value = "";
        }

        function closeModals() {
            document.querySelectorAll('.modal-overlay').forEach(el => el.classList.remove('open'));
            document.getElementById('transaction-form').reset();
            document.getElementById('card-form').reset();
            document.getElementById('t-id').value = "";
            document.getElementById('c-id').value = "";
            document.getElementById('t-date').valueAsDate = new Date();
            selectType('income', document.getElementById('opt-income'));
        }

        function openTransactionModal(id = null) {
            document.getElementById('transaction-modal').classList.add('open');
            document.getElementById('t-date').valueAsDate = new Date();
            if (id) {
                const t = state.transactions.find(x => x.id === id);
                if(!t) return;
                document.getElementById('t-modal-title').textContent = "Editar Transa√ß√£o";
                document.getElementById('t-id').value = t.id;
                document.getElementById('t-desc').value = t.desc;
                document.getElementById('t-amount').value = t.amount;
                document.getElementById('t-category').value = t.category;
                document.getElementById('t-date').value = t.date;
                document.getElementById('t-card').value = t.cardId || "";
                selectType(t.type, document.getElementById(t.type === 'income' ? 'opt-income' : 'opt-expense'));
            } else {
                document.getElementById('t-modal-title').textContent = "Nova Transa√ß√£o";
                document.getElementById('t-id').value = "";
                selectType('income', document.getElementById('opt-income'));
            }
            updateCardSelect();
        }

        function openCardModal(id = null) {
            document.getElementById('card-modal').classList.add('open');
            if(id) {
                const c = state.cards.find(x => x.id === id);
                document.getElementById('c-modal-title').textContent = "Editar Cart√£o";
                document.getElementById('c-id').value = c.id;
                document.getElementById('c-name').value = c.name;
                document.getElementById('c-limit').value = c.limit;
                document.getElementById('c-color').value = c.color;
            } else {
                document.getElementById('c-modal-title').textContent = "Novo Cart√£o";
                document.getElementById('c-id').value = "";
            }
        }

        document.getElementById('transaction-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const id = document.getElementById('t-id').value;
            const type = document.querySelector('.radio-option.selected').id === 'opt-income' ? 'income' : 'expense';
            const cardId = document.getElementById('t-card').value;
            const tData = {
                type, desc: document.getElementById('t-desc').value,
                amount: parseFloat(document.getElementById('t-amount').value),
                category: document.getElementById('t-category').value,
                date: document.getElementById('t-date').value,
                cardId: cardId || null
            };
            saveTransactionToFirebase(tData, id || null);
            closeModals();
        });

        document.getElementById('card-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const id = document.getElementById('c-id').value;
            const cData = {
                name: document.getElementById('c-name').value,
                limit: parseFloat(document.getElementById('c-limit').value),
                color: document.getElementById('c-color').value
            };
            saveCardToFirebase(cData, id || null);
            closeModals();
        });

        function formatCurrency(val, withSymbol = true) {
            const formatted = val.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            return withSymbol ? `R$ ${formatted}` : formatted;
        }
        function formatDate(isoDate) {
            if(!isoDate) return '';
            const [y, m, d] = isoDate.split('-');
            return `${d}/${m}/${y}`;
        }
        function showToast(msg, type = 'info') {
            const container = document.getElementById('toast-area');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.style.borderLeftColor = type === 'success' ? '#48bb78' : (type === 'error' ? '#f56565' : '#5a67d8');
            toast.innerHTML = `<span>${msg}</span>`;
            container.appendChild(toast);
            setTimeout(() => { toast.style.opacity = 0; setTimeout(() => toast.remove(), 300); }, 3000);
        }

        initTheme();
    </script>
